{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import io from\"socket.io-client\";import axios from\"axios\";import UserList from\"./UserList\";import\"./App.css\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const socket=io();function ChatForm(_ref){let{user}=_ref;const[receiver,setReceiver]=useState(null);const[message,setMessage]=useState(\"\");const[messages,setMessages]=useState([]);const fetchMessages=async()=>{if(!receiver)return;const res=await axios.get(`https://react-chat-app-1-bz2b.onrender.com/api/messages/${user.id}/${receiver.id}`);setMessages(res.data);};useEffect(()=>{fetchMessages();},[receiver]);useEffect(()=>{socket.on(\"receive_message\",data=>{if(data.sender_id===user.id&&data.receiver_id===(receiver===null||receiver===void 0?void 0:receiver.id)||data.sender_id===(receiver===null||receiver===void 0?void 0:receiver.id)&&data.receiver_id===user.id){setMessages(prev=>[...prev,data]);}});return()=>socket.off(\"receive_message\");},[receiver]);const sendMessage=()=>{if(!message||!receiver)return;socket.emit(\"send_message\",{sender_id:user.id,receiver_id:receiver.id,message});setMessage(\"\");};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-container\",children:[/*#__PURE__*/_jsxs(\"aside\",{className:\"sidebar\",children:[/*#__PURE__*/_jsx(\"h3\",{children:user.username}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{localStorage.removeItem(\"user\");window.location.reload();},style:{marginBottom:\"10px\",padding:\"8px 16px\",backgroundColor:\"#e74c3c\",color:\"white\",border:\"none\",borderRadius:\"8px\",cursor:\"pointer\",fontWeight:\"bold\"},children:\"\\u0110\\u0103ng xu\\u1EA5t\"}),/*#__PURE__*/_jsx(\"hr\",{style:{marginBottom:\"15px\"}}),/*#__PURE__*/_jsx(UserList,{currentUserId:user.id,onSelectUser:setReceiver})]}),/*#__PURE__*/_jsx(\"main\",{className:\"chat-box\",children:receiver?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"header\",{className:\"chat-header\",children:[/*#__PURE__*/_jsx(\"img\",{src:receiver.avatar,alt:\"avatar\"}),/*#__PURE__*/_jsx(\"h4\",{children:receiver.username})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-messages\",children:messages.map((msg,index)=>/*#__PURE__*/_jsx(\"div\",{className:msg.sender_id===user.id?\"message me\":\"message\",children:msg.message},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-input\",children:[/*#__PURE__*/_jsx(\"input\",{value:message,onChange:e=>setMessage(e.target.value),placeholder:\"Nh\\u1EADp tin nh\\u1EAFn...\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,children:\"G\\u1EEDi\"})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"chat-placeholder\",children:\"Ch\\u1ECDn ng\\u01B0\\u1EDDi \\u0111\\u1EC3 b\\u1EAFt \\u0111\\u1EA7u tr\\xF2 chuy\\u1EC7n\"})})]});}export default ChatForm;","map":{"version":3,"names":["React","useEffect","useState","io","axios","UserList","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","socket","ChatForm","_ref","user","receiver","setReceiver","message","setMessage","messages","setMessages","fetchMessages","res","get","id","data","on","sender_id","receiver_id","prev","off","sendMessage","emit","className","children","username","onClick","localStorage","removeItem","window","location","reload","style","marginBottom","padding","backgroundColor","color","border","borderRadius","cursor","fontWeight","currentUserId","onSelectUser","src","avatar","alt","map","msg","index","value","onChange","e","target","placeholder"],"sources":["C:/chat-app/client/src/ChatForm.jsx"],"sourcesContent":["\nimport React, { useEffect, useState } from \"react\";\nimport io from \"socket.io-client\";\nimport axios from \"axios\";\nimport UserList from \"./UserList\";\nimport \"./App.css\";\n\nconst socket = io();\n\nfunction ChatForm({ user }) {\n  const [receiver, setReceiver] = useState(null);\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n\n  const fetchMessages = async () => {\n    if (!receiver) return;\n    const res = await axios.get(`https://react-chat-app-1-bz2b.onrender.com/api/messages/${user.id}/${receiver.id}`);\n    setMessages(res.data);\n  };\n\n  useEffect(() => {\n    fetchMessages();\n  }, [receiver]);\n\n  useEffect(() => {\n    socket.on(\"receive_message\", (data) => {\n      if (\n        (data.sender_id === user.id && data.receiver_id === receiver?.id) ||\n        (data.sender_id === receiver?.id && data.receiver_id === user.id)\n      ) {\n        setMessages((prev) => [...prev, data]);\n      }\n    });\n    return () => socket.off(\"receive_message\");\n  }, [receiver]);\n\n  const sendMessage = () => {\n    if (!message || !receiver) return;\n    socket.emit(\"send_message\", {\n      sender_id: user.id,\n      receiver_id: receiver.id,\n      message,\n    });\n    setMessage(\"\");\n  };\n\n  return (\n    <div className=\"chat-container\">\n      <aside className=\"sidebar\">\n        <h3>{user.username}</h3>\n  \n        <button\n          onClick={() => {\n            localStorage.removeItem(\"user\");\n            window.location.reload();\n          }}\n          style={{\n            marginBottom: \"10px\",\n            padding: \"8px 16px\",\n            backgroundColor: \"#e74c3c\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"8px\",\n            cursor: \"pointer\",\n            fontWeight: \"bold\"\n          }}\n        >\n          Đăng xuất\n        </button>\n        <hr style={{ marginBottom: \"15px\" }} />\n        <UserList currentUserId={user.id} onSelectUser={setReceiver} />\n        \n      </aside>\n  \n      <main className=\"chat-box\">\n        {receiver ? (\n          <>\n            <header className=\"chat-header\">\n              <img src={receiver.avatar} alt=\"avatar\" />\n              <h4>{receiver.username}</h4>\n            </header>\n            <div className=\"chat-messages\">\n              {messages.map((msg, index) => (\n                <div\n                  key={index}\n                  className={msg.sender_id === user.id ? \"message me\" : \"message\"}\n                >\n                  {msg.message}\n                </div>\n              ))}\n            </div>\n            <div className=\"chat-input\">\n              <input\n                value={message}\n                onChange={(e) => setMessage(e.target.value)}\n                placeholder=\"Nhập tin nhắn...\"\n              />\n              <button onClick={sendMessage}>Gửi</button>\n            </div>\n          </>\n        ) : (\n          <div className=\"chat-placeholder\">Chọn người để bắt đầu trò chuyện</div>\n        )}\n      </main>\n    </div>\n  );\n  \n}\n\nexport default ChatForm;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}